generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id             String                        @id @default(cuid()) @map("user_id")
  name           String                        @unique @map("user_name")
  passwordHash   String                        @map("password_hash")
  salt           String
  participants   Participant[]
  discussionPoints DiscussionPoint[]
  discussionPointConclusions DiscussionPointConclusion[]
  discussionPointConclusionLikes DiscussionPointConclusionLike[] @relation("DiscussionPointConclusionLiker")
  discussionPointConclusionAuthorLikes DiscussionPointConclusionLike[] @relation("DiscussionPointConclusionAuthor")
  participantConclusionLikes ParticipantConclusionLike[]
  userValues     UserValue[]
  norms          Norm[]

  @@map("users")
}

model Discussion {
  id                     String             @id @default(cuid()) @map("d_id")
  code                   Int                @unique @map("d_code")
  discussionTheme        String             @map("discussion_theme")
  inclusionProblemPartOf Boolean            @default(false) @map("inclusion_problem_part_of")
  normsPartOf            Boolean            @default(false) @map("norms_part_of")
  step                   Int                @default(0)
  participants           Participant[]
  discussionPoints       DiscussionPoint[]
  frameOfValues          FrameOfValue[]
  userValues             UserValue[]
  norms                  Norm[]

  @@map("discussion")
}

model Participant {
  id             String                        @id @default(cuid()) @map("p_id")
  userId         String                        @map("u_id")
  discussionId   String                        @map("d_id")
  mainConclusion String?                       @map("main_conclusion")
  continueButton Boolean                       @default(false) @map("continue_button")
  admin          Boolean                       @default(false)
  user           User                          @relation(fields: [userId], references: [id], onDelete: Cascade)
  discussion     Discussion                    @relation(fields: [discussionId], references: [id], onDelete: Cascade)
  participantConclusionLikes ParticipantConclusionLike[]

  @@unique([userId, discussionId])
  @@map("participants")
}

model DiscussionPoint {
  id               String                     @id @default(cuid()) @map("dp_id")
  writtenByUserId  String                     @map("written_by_u_id")
  discussionId     String                     @map("d_id")
  markedAsComplete Boolean                    @default(false) @map("marked_as_complete")
  discussionPoint  String                     @map("discussion_point")
  writtenBy        User                       @relation(fields: [writtenByUserId], references: [id], onDelete: Cascade)
  discussion       Discussion                 @relation(fields: [discussionId], references: [id], onDelete: Cascade)
  conclusions      DiscussionPointConclusion[]

  @@map("discussionpoints")
}

model DiscussionPointConclusion {
  id               String                     @id @default(cuid()) @map("dp_conclusion_id")
  discussionPointId String                    @map("dp_id")
  userId           String                     @map("u_id")
  conclusion       String
  discussionPoint  DiscussionPoint            @relation(fields: [discussionPointId], references: [id], onDelete: Cascade)
  user             User                       @relation(fields: [userId], references: [id], onDelete: Cascade)
  likes            DiscussionPointConclusionLike[]

  @@unique([discussionPointId, userId])
  @@map("conclusions_discussionpoints")
}

model DiscussionPointConclusionLike {
  likerUserId              String                     @map("user_likes_id")
  dpConclusionId           String                     @map("dp_conclusion_id")
  conclusionWrittenByUserId String                    @map("conclusion_written_by_user_id")
  createdAt                DateTime                   @default(now()) @map("created_at")
  liker                    User                       @relation("DiscussionPointConclusionLiker", fields: [likerUserId], references: [id], onDelete: Cascade)
  conclusion               DiscussionPointConclusion   @relation(fields: [dpConclusionId], references: [id], onDelete: Cascade)
  conclusionAuthor         User                       @relation("DiscussionPointConclusionAuthor", fields: [conclusionWrittenByUserId], references: [id], onDelete: Cascade)

  @@id([likerUserId, dpConclusionId, conclusionWrittenByUserId])
  @@map("likes_discussionpoint_conclusion")
}

model ParticipantConclusionLike {
  likerUserId  String      @map("user_likes_id")
  participantId String     @map("participants_conclusion_id")
  createdAt    DateTime    @default(now()) @map("created_at")
  liker        User        @relation(fields: [likerUserId], references: [id], onDelete: Cascade)
  participant  Participant @relation(fields: [participantId], references: [id], onDelete: Cascade)

  @@id([likerUserId, participantId])
  @@map("likes_discussion_conclusion")
}

model FrameOfValue {
  discussionId String   @map("d_id")
  valueId      String   @map("v_id")
  partOfFrame  Boolean  @default(false) @map("part_of_frame")
  discussion   Discussion @relation(fields: [discussionId], references: [id], onDelete: Cascade)
  value        Value     @relation(fields: [valueId], references: [id], onDelete: Cascade)
  norms        Norm[]
  userValues   UserValue[]

  @@id([discussionId, valueId])
  @@map("frame_of_values")
}

model UserValue {
  discussionId String @map("d_id")
  valueId      String @map("v_id")
  userId       String @map("u_id")
  discussion   Discussion @relation(fields: [discussionId], references: [id], onDelete: Cascade)
  value        Value @relation(fields: [valueId], references: [id], onDelete: Cascade)
  user         User @relation(fields: [userId], references: [id], onDelete: Cascade)
  frameOfValue FrameOfValue? @relation(fields: [discussionId, valueId], references: [discussionId, valueId], onDelete: Cascade)

  @@id([discussionId, valueId, userId])
  @@map("user_values")
}

model Value {
  id     String        @id @default(cuid()) @map("v_id")
  value  String        @unique
  frameOfValues FrameOfValue[]
  userValues   UserValue[]

  @@map("values")
}

model Norm {
  id            String  @id @default(cuid()) @map("n_id")
  discussionId  String  @map("d_id")
  userId        String  @map("u_id")
  norm          String
  basedOnValueId String @map("based_on_value")
  partOfFrame   Boolean @default(false) @map("part_of_frame")
  discussion    Discussion @relation(fields: [discussionId], references: [id], onDelete: Cascade)
  user          User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  frameOfValue  FrameOfValue @relation(fields: [discussionId, basedOnValueId], references: [discussionId, valueId], onDelete: Cascade)

  @@index([discussionId, userId])
  @@map("norms")
}
